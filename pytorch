PyTorch 安装与基础使用完整教程

一、前言：认识 PyTorch

PyTorch 是由 Facebook（现 Meta）开发的开源深度学习框架，以简洁易用、动态计算图、良好的Python生态兼容性著称，广泛应用于学术研究和工业界开发，涵盖计算机视觉、自然语言处理、语音识别等多个领域。

本教程基于 Anaconda 环境（需先完成 Anaconda 安装，参考前文教程），详细讲解 PyTorch 的环境配置、安装步骤、核心概念及基础操作，帮助新手快速入门。

二、安装前核心准备

2.1 环境依赖确认

PyTorch 安装需依赖以下环境，需提前验证：

- Anaconda 环境：已安装并能正常使用 conda 命令（验证：终端输入 conda --version 输出版本信息）；

- Python 版本：推荐 3.8-3.11（PyTorch 对最新 Python 版本支持可能延迟，可通过 python --version 查看）；

- GPU 兼容性（可选）：若有 NVIDIA 显卡，需确认已安装兼容的 CUDA Toolkit（参考 CUDA 安装教程），AMD 显卡可使用 ROCm 版本（本教程以 NVIDIA GPU 为例）。

2.2 创建专属环境（推荐）

为避免包依赖冲突，建议创建独立的 PyTorch 环境：

# 1. 打开终端/Anaconda Prompt，创建名为 pytorch_env 的环境（Python 3.10 为例）
conda create -n pytorch_env python=3.10

# 2. 激活环境（后续操作均在此环境下执行）
# Windows
conda activate pytorch_env
# Linux/macOS
source activate pytorch_env

三、PyTorch 安装步骤（分场景）

3.1 安装方式选择

PyTorch 提供两种主流安装方式，推荐 conda 安装（兼容性更好，自动处理依赖），也可选择 pip 安装：

- CPU 版本：无显卡或仅用于简单测试，安装简单但无加速；

- GPU 版本：需 NVIDIA 显卡+CUDA 支持，深度学习训练效率大幅提升。

3.2 获取官方安装命令（关键）

PyTorch 版本与 CUDA 版本需严格匹配，建议从官网获取适配命令：

1. 访问 PyTorch 官方安装页；

2. 根据系统和需求选择参数：
        OS：选择对应系统（Windows/Linux/macOS）；

3. Package：选择 Conda 或 Pip；

4. Language：Python；

5. Compute Platform：
            GPU 版：选择对应 CUDA 版本（如 CUDA 12.1）；

6. CPU 版：选择 CPU；

7. macOS （Apple 芯片）：选择 MPS （硬件加速）。

8. 复制生成的安装命令（示例如下）。

3.3 分场景执行安装

3.3.1 Windows/Linux 系统（GPU 版，CUDA 12.1 为例）

# conda 安装命令（已激活 pytorch_env 环境）
conda install pytorch torchvision torchaudio pytorch-cuda=12.1 -c pytorch -c nvidia

3.3.2 所有系统（CPU 版）

# conda 安装命令
conda install pytorch torchvision torchaudio cpuonly -c pytorch

# 若用 pip 安装
pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu

3.3.3 macOS 系统（Apple 芯片，MPS 加速）

# conda 安装命令
conda install pytorch torchvision torchaudio -c pytorch

# pip 安装命令
pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu

注意：安装过程约 5-15 分钟（取决于网络和版本），若下载速度慢，可配置国内镜像源（如清华源），具体参考 Anaconda 教程的镜像配置部分。

四、安装验证（必做）

在激活的 pytorch_env 环境中，通过 Python 交互模式验证安装：

# 1. 打开 Python 交互环境
python

# 2. 导入 PyTorch 并查看版本
import torch
print(torch.__version__)  # 输出版本信息，如 2.1.2+cu121

# 3. 验证 GPU/MPS 是否可用（关键）
# NVIDIA GPU 验证
print(torch.cuda.is_available())  # 输出 True 表示 GPU 可用
print(torch.cuda.get_device_name(0))  # 输出 GPU 型号

# Apple 芯片（MPS）验证
print(torch.backends.mps.is_available())  # 输出 True 表示 MPS 可用

# 4. 简单张量运算测试（验证核心功能）
x = torch.tensor([1.0, 2.0, 3.0])
y = torch.tensor([4.0, 5.0, 6.0])
print(x + y)  # 输出 tensor([5., 7., 9.])，表示正常工作

若所有命令无报错且 GPU/MPS 验证为 True（对应场景），则安装成功。

五、PyTorch 核心基础操作

5.1 核心概念：张量（Tensor）

张量是 PyTorch 中数据的基本载体，类似 NumPy 数组，但支持 GPU 加速和自动求导，以下是常用操作：

import torch

# 1. 创建张量
a = torch.tensor([[1, 2], [3, 4]])  # 从列表创建 2x2 张量
b = torch.zeros((2, 2))  # 全零张量
c = torch.ones((2, 2))   # 全一张量
d = torch.randn((2, 2))  # 标准正态分布随机张量

# 2. 张量属性
print(a.shape)  # 形状：torch.Size([2, 2])
print(a.dtype)  # 数据类型：torch.int64
print(a.device) # 设备：cpu 或 cuda:0

# 3. 张量运算
e = a + c  # 加法
f = a * d  # 元素乘法
g = a @ a  # 矩阵乘法（等价于 torch.matmul(a, a)）

# 4. 张量与 NumPy 转换
import numpy as np
a_np = a.numpy()  # 张量转 NumPy 数组
a_tensor = torch.from_numpy(a_np)  # NumPy 数组转张量

# 5. 张量转移到 GPU
if torch.cuda.is_available():
    a_gpu = a.to('cuda')
    print(a_gpu.device)  # 输出 cuda:0

5.2 自动求导（Autograd）：深度学习核心

PyTorch 自动计算梯度，无需手动推导，通过 requires_grad=True 开启：

import torch

# 1. 创建带梯度跟踪的张量
x = torch.tensor([1.0], requires_grad=True)
y = x ** 2 + 2 * x + 1  # 定义函数 y = x² + 2x + 1

# 2. 反向传播求梯度（对 x 求导）
y.backward()

# 3. 查看梯度（dy/dx = 2x + 2，x=1 时梯度为 4）
print(x.grad)  # 输出 tensor([4.])

5.3 简单模型构建（线性回归示例）

import torch
import torch.nn as nn
import torch.optim as optim

# 1. 定义线性回归模型（继承 nn.Module）
class LinearRegression(nn.Module):
    def __init__(self):
        super(LinearRegression, self).__init__()
        self.linear = nn.Linear(1, 1)  # 输入维度 1，输出维度 1

    def forward(self, x):
        out = self.linear(x)
        return out

# 2. 准备数据（模拟 y = 2x + 1 + 噪声）
x = torch.tensor([[1.0], [2.0], [3.0], [4.0]], dtype=torch.float32)
y_true = torch.tensor([[3.0], [5.0], [7.0], [9.0]], dtype=torch.float32)

# 3. 初始化模型、损失函数和优化器
model = LinearRegression()
criterion = nn.MSELoss()  # 均方误差损失
optimizer = optim.SGD(model.parameters(), lr=0.01)  # 随机梯度下降

# 4. 模型训练（1000 轮）
for epoch in range(1000):
    # 前向传播：计算预测值
    y_pred = model(x)
    # 计算损失
    loss = criterion(y_pred, y_true)
    # 反向传播：清空梯度→求梯度→更新参数
    optimizer.zero_grad()
    loss.backward()
    optimizer.step()

# 5. 测试模型
model.eval()  # 切换到评估模式
with torch.no_grad():  # 禁用梯度计算
    x_test = torch.tensor([[5.0]], dtype=torch.float32)
    y_test = model(x_test)
    print(y_test)  # 输出接近 11.0，符合 y=2x+1

六、常见问题与解决方案

1. 问题：导入 torch 报错“ModuleNotFoundError”解决方案：① 确认已激活 pytorch_env 环境；② 重新执行安装命令，确保安装成功；③ 若用 pip 安装，检查 pip 版本与 Python 版本是否匹配。

2. 问题：torch.cuda.is_available() 输出 False（GPU 已安装）解决方案：① 确认 CUDA 版本与 PyTorch 版本匹配；② 检查显卡驱动是否正常（执行 nvidia-smi 查看）；③ 重新安装对应 CUDA 版本的 PyTorch。

3. 问题：训练时 GPU 内存不足（CUDA out of memory）解决方案：① 减小批次大小（batch_size）；② 降低输入数据分辨率（如图像任务）；③ 使用梯度累积；④ 关闭其他占用 GPU 资源的程序。

4. 问题：macOS 下 MPS 验证失败解决方案：① 确认 macOS 版本 ≥ 12.3；② 升级 PyTorch 到 1.12 及以上版本；③ 重新执行官方提供的 macOS 安装命令。

七、进阶学习资源

- PyTorch 官方教程：PyTorch Tutorials（涵盖基础到进阶）；

- PyTorch 官方文档：官方 API 文档；

- 《深度学习框架 PyTorch 入门与实践》（书籍，适合新手）；

- PyTorch 中文社区：PyTorch 中文教程。
