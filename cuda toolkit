CUDA Toolkit 安装全教程

前言：认识 CUDA Toolkit

CUDA Toolkit 是 NVIDIA 推出的核心开发工具集，是基于 CUDA 并行计算平台进行开发和运行的基础。它包含编译器（如 nvcc）、调试工具、常用并行计算库（CUDA BLAS、CUDA FFT 等）、示例代码等组件，能够让开发者充分利用 NVIDIA GPU 的并行计算能力，加速深度学习、科学计算、视频编解码等密集型任务。

本教程将详细讲解 Windows 和 Linux 系统下 CUDA Toolkit 的安装流程，包含前期准备、步骤操作、安装验证及问题解决，适用于各类需要 CUDA 加速的开发场景。

一、安装前核心准备

1.1 硬件兼容性检查

CUDA Toolkit 仅支持 NVIDIA 显卡，需先确认显卡型号是否在官方支持列表内（官方支持显卡列表）。可通过以下命令快速查看显卡信息：

# Windows 系统：打开命令提示符（CMD）或PowerShell执行
dxdiag
# 打开后切换至「显示」选项卡，查看「显卡型号」字段

# Linux 系统：打开终端执行
lspci | grep -i nvidia
# 输出结果将显示NVIDIA显卡型号，如「NVIDIA GeForce RTX 3060」

1.2 版本匹配关键原则

CUDA Toolkit 与 GPU 驱动版本存在严格兼容性，核心原则为：当前 GPU 驱动版本 ≥ 目标 CUDA Toolkit 要求的最低驱动版本。可通过以下步骤确认：

1. 查看当前 GPU 驱动版本：
        # Windows/Linux 系统通用：终端或CMD执行
nvidia-smi
# 输出结果中「Driver Version」为当前驱动版本，「CUDA Version」为驱动支持的最高CUDA版本

2. 查询版本兼容表：访问 CUDA Toolkit 版本兼容表，根据目标 Toolkit 版本确认最低驱动版本。例如 CUDA Toolkit 12.4 要求驱动版本 ≥ 551.23。

二、Windows 系统安装步骤

2.1 卸载旧版本（如有）

若之前安装过 CUDA Toolkit，需先彻底卸载避免版本冲突：

1. 打开「控制面板 → 程序和功能」；

2. 卸载所有名称包含「NVIDIA CUDA Toolkit」的条目，以及对应的「NVIDIA CUDA Development」相关组件；

3. 卸载完成后重启电脑。

2.2 下载 CUDA Toolkit 安装包

1. 访问 CUDA Toolkit 归档页面，选择目标版本（如 12.4）；

2. 根据系统配置选择参数：
        Operating System：Windows 10 或 Windows 11（根据实际系统选择）；

3. Architecture：x86_64；

4. Installer Type：推荐「exe (local)」本地安装包（稳定性更高）；

5. 点击「Download」下载安装包（约 3-5GB，建议保持网络稳定）。

2.3 执行安装流程

# 双击下载的exe安装包，按以下步骤操作：
1. 选择临时解压路径（默认即可，安装后会自动删除），点击「OK」；
2. 等待解压完成后，进入安装向导，点击「同意并继续」；
3. 选择安装类型：推荐「自定义（高级）」，避免安装不必要组件；
4. 组件选择：
   - 必选：「CUDA Toolkit」核心组件（包含编译器、库文件等）；
   - 可选：取消「Visual Studio Integration」（若未安装VS或无需关联）、「PhysX」等非核心组件；
   - 驱动选择：若当前驱动版本低于最低要求，勾选「NVIDIA Graphics Driver」；若已满足要求，取消勾选避免重复安装；
5. 选择安装路径：默认路径「C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\版本号」即可，禁止包含中文或特殊字符；
6. 点击「下一步」，等待安装完成（约5-10分钟），点击「关闭」。

2.4 配置环境变量（关键步骤）

安装完成后需手动检查并补充环境变量，确保系统能识别 CUDA 命令：

1. 打开环境变量配置：右键「此电脑 → 属性 → 高级系统设置 → 环境变量」；

2. 配置系统变量（推荐，所有用户可用）：
        新建变量「CUDA_PATH」，值为安装路径（如「C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\12.4」）；

3. 新建变量「CUDA_PATH_V12_4」（版本号对应，如12.4则为V12_4），值与「CUDA_PATH」一致；

4. 编辑「Path」变量，添加以下两条路径：
            %CUDA_PATH%\bin

5. %CUDA_PATH%\libnvvp

6. 点击「确定」保存，关闭所有打开的终端（环境变量需重启终端生效）。

三、Linux 系统安装步骤（以 Ubuntu 为例）

3.1 卸载旧版本（如有）

# 1. 执行官方卸载脚本（将X.Y替换为旧版本号，如12.3）
sudo /usr/local/cuda-X.Y/bin/cuda-uninstaller
# 2. 清理残留文件
sudo rm -rf /usr/local/cuda-X.Y
# 3. 若安装过驱动，可执行以下命令卸载驱动
sudo apt-get purge nvidia-*
sudo apt-get autoremove

3.2 安装依赖库

# Ubuntu/Debian 系统
sudo apt-get update
sudo apt-get install build-essential gcc g++ make libssl-dev

# 若为 CentOS/RHEL 系统
sudo yum update
sudo yum install gcc gcc-c++ make openssl-devel

3.3 下载并安装 CUDA Toolkit

推荐使用「runfile」安装方式，灵活性更高：

# 1. 访问归档页面选择版本，获取下载链接（以12.4为例）
# 下载地址：https://developer.nvidia.com/cuda-12-4-0-download-archive?target_os=Linux&target_arch=x86_64&Distribution=Ubuntu&target_version=22.04&target_type=runfile_local

# 2. 终端下载安装包（或浏览器下载后传输至服务器）
wget https://developer.download.nvidia.com/compute/cuda/12.4.0/local_installers/cuda_12.4.0_550.54.15_linux.run

# 3. 赋予执行权限
chmod +x cuda_12.4.0_550.54.15_linux.run

# 4. 执行安装（--toolkit仅安装核心组件，--silent静默安装，--override忽略版本检查）
sudo ./cuda_12.4.0_550.54.15_linux.run --toolkit --silent --override
# 若需安装驱动，移除--toolkit参数，安装时勾选「Driver」组件

3.4 配置环境变量（永久生效）

# 1. 编辑用户环境变量配置文件
vim ~/.bashrc

# 2. 在文件末尾添加以下内容（版本号对应实际安装版本）
export CUDA_PATH=/usr/local/cuda-12.4
export PATH=$CUDA_PATH/bin:$PATH
export LD_LIBRARY_PATH=$CUDA_PATH/lib64:$LD_LIBRARY_PATH

# 3. 生效配置
source ~/.bashrc

# 4. 验证环境变量（可选）
echo $CUDA_PATH
# 输出/usr/local/cuda-12.4即为配置成功

四、安装验证（必做步骤）

通过以下命令确认 CUDA Toolkit 是否安装成功：

# 1. 查看 CUDA Toolkit 版本（编译器版本）
nvcc -V
# 成功输出：显示「Cuda compilation tools, release 12.4, V12.4.99」等信息

# 2. 运行官方设备查询示例（验证GPU识别）
# 进入示例代码目录
cd /usr/local/cuda/samples/1_Utilities/deviceQuery
# 编译示例
make
# 执行查询
./deviceQuery
# 成功输出：显示GPU型号、核心数等信息，末尾提示「Result = PASS」

关键提示：nvcc -V 中的「V」必须为大写，小写会报错；若执行 deviceQuery 提示「缺少库文件」，检查 LD_LIBRARY_PATH 环境变量是否配置正确。

五、常见问题与解决方案

1. 问题：nvcc -V 命令未找到解决方案：① 检查环境变量 PATH 是否包含 CUDA 的 bin 目录；② 执行 source ~/.bashrc（Linux）或重启终端（Windows）；③ 确认安装路径是否正确，若安装多个版本需指定对应路径。

2. 问题：驱动版本不兼容，安装失败解决方案：① 根据 Toolkit 版本要求，从 NVIDIA 驱动官网 下载对应驱动；② Linux 系统可通过「sudo apt-get install nvidia-driver-550」（550为驱动版本）快速安装。

3. 问题：Linux 安装时提示「gcc 版本过高」解决方案：① 安装兼容版本 gcc（如 CUDA 12.4 支持 gcc 11 及以下，可安装 gcc-11）；② 安装命令中添加 --override 参数强制忽略版本检查；③ 临时指定低版本 gcc 编译：export CC=gcc-11 CXX=g++-11。

4. 问题：Windows 安装后设备查询失败解决方案：① 检查显卡是否支持当前 Toolkit 版本；② 重启电脑，确保驱动生效；③ 重新安装 Toolkit，选择「完整安装」模式。

六、参考文献

- CUDA Toolkit 官方安装指南：Linux 版 / Windows 版

- NVIDIA CUDA 显卡支持列表：官方链接

- CUDA Toolkit 与驱动版本兼容性表：官方文档
